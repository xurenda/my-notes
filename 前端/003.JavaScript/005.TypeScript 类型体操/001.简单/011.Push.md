---
date: 2024-08-21 15:55
modified: 2024-08-21 18:44
---

在类型系统里实现通用的 `Array.push`

例如：

```ts
type Result = Push<[1, 2], '3'> // [1, 2, '3']
```

> [!NOTE]- 答案
> 
> ```ts
> type Push<T extends readonly any[], U> = [...T, U]
> ```

拓展：第二个泛型也支持数组

> [!NOTE]- 拓展答案
> 
> ```ts
> type Push<T extends readonly any[], U> = U extends readonly any[] ? [...T, ...U] : [...T, U]
> ```
> 
> 这样有一个问题，不能通过测试用例 1：
> 
> ```ts
> // 测试用例 1
> Expect<Equal<Push<['1', 2, '3'], boolean>, ['1', 2, '3', boolean]>>
> ```
> 
> 原因是 `boolean` 是 `true | false` 联合类型，`Push<['1', 2, '3'], boolean>` 会变成 `['1', 2, '3', true] | ['1', 2, '3', false]`，而不是 `['1', 2, '3', boolean]`（参考：[分配条件类型](https://www.typescriptlang.org/docs/handbook/2/conditional-types.html#distributive-conditional-types)）
> 
> 将类型定义改成：
> 
> ```ts
> type Push<T extends readonly any[], U> = U extends readonly any[]
>   ? [...T, ...U]
>   : U extends boolean
>     ? [...T, boolean]
>     : [...T, U]
> ```
> 
> 可以通过测试用例 1，但是又会导致通不过以下测试用例：
> 
> ```ts
> Expect<Equal<Push<['1', 2, '3'], true>, ['1', 2, '3', true]>>
> 
> Expect<Equal<Push<['1', 2, '3'], false>, ['1', 2, '3', false]>>
> ```
> 
> 如果再加上 `true` 和 `false` 的判断，又会导致测试用例 1 通不过：
> 
> ```ts
> type Push<T extends readonly any[], U> = U extends readonly unknown[]
>   ? [...T, ...U]
>   : U extends true
>     ? [...T, true]
>     : U extends false
>       ? [...T, false]
>       : U extends boolean
>         ? [...T, boolean]
>         : [...T, U]
> ```
> 
> 在 chatGPT 的帮助下，终于有了解决办法：
> 
> ```ts
> type Push<T extends readonly any[], U> = [U] extends [readonly any[]] ? [...T, ...U] : [...T, U]
>```
