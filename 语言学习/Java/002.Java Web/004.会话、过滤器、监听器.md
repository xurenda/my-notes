---
date: 2024-01-21 20:45
modified: 2024-01-21 20:45
---

# 会话

## 会话管理概述

### 为什么需要会话管理

HTTP 是无状态协议

- 无状态就是不保存状态，即无状态协议（stateless），HTTP 协议自身不对请求和响应之间的通信状态进行保存，也就是说，在 HTTP 协议这个级别，协议对于发送过的请求或者响应都不做持久化处理
- 简单理解：浏览器发送请求，服务器接收并响应，但是服务器不记录请求是否来自哪个浏览器，服务器没记录浏览器的特征，就是客户端的状态

举例：张三去一家饭馆点了几道菜，觉得味道不错，第二天又去了，对老板说，还点上次的那几道菜

- 无状态：老板没有记录张三是否来过，更没有记录上次他点了那些菜，张三只能重新再点一遍
- 有状态：老板把每次来吃饭的用户都做好记录，查阅一下之前的记录，查到了张三之前的菜单，直接下单

### 会话管理实现的手段

Cookie 和 Session 配合解决

- Cookie 是在客户端保留少量数据的技术，主要通过响应头向客户端响应一些客户端要保留的信息
- Session 是在服务端保留更多数据的技术，主要通过 `HttpSession` 对象保存一些和客户端相关的信息
- Cookie 和 Session 配合记录请求状态

举例：张三去银行办业务

- 张三第一次去某个银行办业务，银行会为张三开户（Session），并向张三发放一张银行卡（Cookie）
- 张三后面每次去银行，就可以携带之间的银行卡（Cookie），银行根据银行卡找到之前张三的账户（Session）

## Cookie

### Cookie 概述

Cookie 是一种客户端会话技术，Cookie 由服务端产生，它是服务器存放在浏览器的一小份数据，浏览器以后每次访问该服务器的时候都会将这小份数据携带到服务器去。

- 服务端创建 Cookie，将 Cookie 放入响应对象中，Tomcat 容器将 Cookie 转化为 `set-cookie` 响应头，响应给客户端
- 客户端在收到 Cookie 的响应头时，在下次请求该服务的资源时，会以 Cookie 请求头的形式携带之前收到的 Cookie
- Cookie 是一种键值对格式的数据，从 tomcat8.5 开始可以保存中文，但是不推荐
- 由于 Cookie 是存储于客户端的数据，比较容易暴露，一般不存储一些敏感或者影响安全的数据

原理图：

![[1682411089082.png]]
